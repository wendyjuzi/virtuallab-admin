# 邮箱验证码接口使用指南

## 概述
本文档详细说明了如何正确调用邮箱验证码相关的API接口，避免常见的错误。

## 可用的邮箱验证码接口

### 1. 通用邮箱验证码发送接口（推荐）
**接口地址**: `POST /api/auth/email/send-code`

**参数**:
- `email` (必填): 邮箱地址
- `type` (可选): 验证码类型，默认为 "LOGIN"

**调用方式**:

#### 方式1: 表单参数
```bash
curl -X POST "http://localhost:8080/api/auth/email/send-code" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "email=test@example.com&type=LOGIN"
```

#### 方式2: 查询参数
```bash
curl -X POST "http://localhost:8080/api/auth/email/send-code?email=test@example.com&type=LOGIN"
```

### 2. JSON格式邮箱验证码发送接口
**接口地址**: `POST /api/auth/email/send-code-json`

**请求体**:
```json
{
  "email": "test@example.com",
  "type": "LOGIN"
}
```

**调用方式**:
```bash
curl -X POST "http://localhost:8080/api/auth/email/send-code-json" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "type": "LOGIN"
  }'
```

### 3. 灵活格式邮箱验证码发送接口
**接口地址**: `POST /api/auth/email/send-flexible`

**支持多种参数传递方式**:
- 仅表单参数
- 仅JSON请求体
- 表单参数+JSON请求体（优先取JSON）

**调用方式**:

#### 仅表单参数
```bash
curl -X POST "http://localhost:8080/api/auth/email/send-flexible" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "email=test@example.com&type=LOGIN"
```

#### 仅JSON请求体
```bash
curl -X POST "http://localhost:8080/api/auth/email/send-flexible" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "type": "LOGIN"
  }'
```

### 4. 管理员专用邮箱验证码发送接口
**接口地址**: `POST /api/auth/factor/email/send`

**参数**:
- `userId` (可选): 用户ID
- `email` (必填): 邮箱地址
- `userType` (必填): 用户类型，必须为 "admin"

**调用方式**:
```bash
curl -X POST "http://localhost:8080/api/auth/factor/email/send" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "email=test@example.com&userType=admin"
```

### 5. 邮箱验证码验证接口
**接口地址**: `POST /api/auth/email/verify-code`

**参数**:
- `email` (必填): 邮箱地址
- `code` (必填): 验证码
- `type` (可选): 验证码类型，默认为 "LOGIN"

**调用方式**:
```bash
curl -X POST "http://localhost:8080/api/auth/email/verify-code" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "email=test@example.com&code=123456&type=LOGIN"
```

## 常见错误及解决方案

### 1. "Request method 'GET' not supported"
**错误原因**: 使用了GET方法，但接口只支持POST方法
**解决方案**: 确保使用POST方法调用接口

### 2. "Required request parameter 'email' for method parameter type String is not present"
**错误原因**: 缺少必需的email参数
**解决方案**: 确保请求中包含email参数

### 3. "Ambiguous handler methods mapped"
**错误原因**: 多个方法映射到同一个路径
**解决方案**: 使用不同的接口路径，避免冲突

## 前端调用示例

### JavaScript (使用fetch)
```javascript
// 发送验证码
async function sendEmailCode(email, type = 'LOGIN') {
  try {
    const response = await fetch('/api/auth/email/send-code', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `email=${encodeURIComponent(email)}&type=${encodeURIComponent(type)}`
    });
    
    const result = await response.json();
    if (result.success) {
      console.log('验证码发送成功');
    } else {
      console.error('验证码发送失败:', result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
}

// 验证验证码
async function verifyEmailCode(email, code, type = 'LOGIN') {
  try {
    const response = await fetch('/api/auth/email/verify-code', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `email=${encodeURIComponent(email)}&code=${encodeURIComponent(code)}&type=${encodeURIComponent(type)}`
    });
    
    const result = await response.json();
    if (result.success) {
      console.log('验证码验证成功');
    } else {
      console.error('验证码验证失败:', result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
}
```

### JavaScript (使用axios)
```javascript
// 发送验证码
async function sendEmailCode(email, type = 'LOGIN') {
  try {
    const response = await axios.post('/api/auth/email/send-code', 
      `email=${encodeURIComponent(email)}&type=${encodeURIComponent(type)}`,
      {
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      }
    );
    
    if (response.data.success) {
      console.log('验证码发送成功');
    } else {
      console.error('验证码发送失败:', response.data.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
}
```

## 测试建议

1. **使用Postman测试**:
   - 选择POST方法
   - 设置正确的Content-Type
   - 确保参数格式正确

2. **使用curl测试**:
   - 参考上面的curl示例
   - 注意URL编码

3. **检查响应格式**:
   ```json
   {
     "code": 200,
     "message": "操作成功",
     "data": true
   }
   ```

## 注意事项

1. **HTTP方法**: 所有邮箱验证码接口都使用POST方法
2. **Content-Type**: 根据参数传递方式设置正确的Content-Type
3. **参数编码**: 使用URL编码处理特殊字符
4. **错误处理**: 始终检查响应中的success字段
5. **频率限制**: 避免频繁发送验证码请求

## 联系支持

如果遇到问题，请检查：
1. 请求方法是否正确（POST）
2. 参数是否完整
3. Content-Type是否正确
4. 服务器是否正常运行 