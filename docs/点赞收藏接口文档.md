# 点赞收藏功能后端接口文档

## 概述

本文档描述了虚拟实验室系统中的点赞和收藏功能的后端API接口。系统提供了完整的点赞、取消点赞、收藏、取消收藏以及相关查询功能。

## 数据库表结构

### 点赞表 (resource_like)
```sql
CREATE TABLE resource_like (
    id          BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id     BIGINT NOT NULL,
    resource_id BIGINT NOT NULL,
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP NULL,
    CONSTRAINT uk_user_resource UNIQUE (user_id, resource_id)
);
```

### 收藏表 (resource_favorite)
```sql
CREATE TABLE resource_favorite (
    id          BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id     BIGINT NOT NULL,
    resource_id BIGINT NOT NULL,
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP NULL,
    CONSTRAINT uk_user_resource UNIQUE (user_id, resource_id)
);
```

## 点赞功能接口

### 1. 查询点赞/收藏状态

**接口地址：** `GET /like-favorite/experiment/{experimentId}`

**请求参数：**
- `experimentId` (路径参数): 实验/资源ID
- `userId` (查询参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "liked": true,
        "favorited": false
    }
}
```

### 2. 点赞资源

**接口地址：** `POST /like-favorite/like/{resourceId}`

**请求参数：**
- `resourceId` (路径参数): 资源ID
- `userId` (查询参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "点赞成功",
    "data": null
}
```

**错误响应：**
```json
{
    "code": 500,
    "message": "您已经点赞过该资源"
}
```

### 3. 取消点赞

**接口地址：** `POST /like-favorite/unlike/{resourceId}`

**请求参数：**
- `resourceId` (路径参数): 资源ID
- `userId` (查询参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "取消点赞成功",
    "data": null
}
```

### 4. 查询用户点赞列表

**接口地址：** `GET /like-favorite/user/{userId}/likes`

**请求参数：**
- `userId` (路径参数): 用户ID
- `page` (查询参数, 可选): 页码，默认1
- `size` (查询参数, 可选): 每页大小，默认10

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": [
        {
            "id": 1,
            "userId": 1,
            "resourceId": 1,
            "createTime": "2024-01-01T10:00:00"
        }
    ]
}
```

### 5. 统计用户点赞数量

**接口地址：** `GET /like-favorite/user/{userId}/likes/count`

**请求参数：**
- `userId` (路径参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": 5
}
```

### 6. 检查是否已点赞

**接口地址：** `GET /like-favorite/is-liked`

**请求参数：**
- `userId` (查询参数): 用户ID
- `resourceId` (查询参数): 资源ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": true
}
```

### 7. 获取资源点赞数量

**接口地址：** `GET /like-favorite/resource/{resourceId}/like-count`

**请求参数：**
- `resourceId` (路径参数): 资源ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": 10
}
```

## 收藏功能接口

### 1. 添加收藏

**接口地址：** `POST /resource-favorite/add`

**请求体：**
```json
{
    "userId": 1,
    "resourceId": 1
}
```

**响应示例：**
```json
{
    "code": 200,
    "message": "收藏成功",
    "data": 1
}
```

### 2. 移除收藏

**接口地址：** `DELETE /resource-favorite/remove/{id}`

**请求参数：**
- `id` (路径参数): 收藏记录ID

**响应示例：**
```json
{
    "code": 200,
    "message": "移除收藏成功",
    "data": 1
}
```

### 3. 查询收藏记录

**接口地址：** `GET /resource-favorite/get/{id}`

**请求参数：**
- `id` (路径参数): 收藏记录ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "id": 1,
        "userId": 1,
        "resourceId": 1,
        "createTime": "2024-01-01T10:00:00"
    }
}
```

### 4. 查询用户收藏列表

**接口地址：** `GET /resource-favorite/list/{userId}`

**请求参数：**
- `userId` (路径参数): 用户ID
- `offset` (查询参数, 可选): 偏移量，默认0
- `size` (查询参数, 可选): 每页大小，默认10

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": [
        {
            "id": 1,
            "userId": 1,
            "resourceId": 1,
            "createTime": "2024-01-01T10:00:00"
        }
    ]
}
```

### 5. 统计用户收藏数量

**接口地址：** `GET /resource-favorite/count/{userId}`

**请求参数：**
- `userId` (路径参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": 3
}
```

### 6. 查询用户资源收藏

**接口地址：** `GET /resource-favorite/getByUserAndResource`

**请求参数：**
- `userId` (查询参数): 用户ID
- `resourceId` (查询参数): 资源ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "id": 1,
        "userId": 1,
        "resourceId": 1,
        "createTime": "2024-01-01T10:00:00"
    }
}
```

### 7. 获取资源收藏数量

**接口地址：** `GET /resource-favorite/resource/{resourceId}/favorite-count`

**请求参数：**
- `resourceId` (路径参数): 资源ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": 5
}
```

### 8. 检查是否已收藏

**接口地址：** `GET /resource-favorite/is-favorited`

**请求参数：**
- `userId` (查询参数): 用户ID
- `resourceId` (查询参数): 资源ID

**响应示例：**
```json
{
    "code": 200,
    "message": "查询成功",
    "data": true
}
```

## 统一响应格式

所有接口都使用统一的响应格式：

```json
{
    "code": 200,           // 状态码：200成功，500失败
    "message": "操作成功",  // 响应消息
    "data": {}            // 响应数据
}
```

## 错误处理

### 常见错误码

- `200`: 操作成功
- `500`: 操作失败

### 常见错误消息

- "您已经点赞过该资源"
- "您还没有点赞该资源"
- "您已经收藏过该资源"
- "您还没有收藏该资源"
- "点赞失败，请稍后重试"
- "取消点赞失败，请稍后重试"
- "收藏失败，请稍后重试"
- "取消收藏失败，请稍后重试"

## 权限要求

所有接口都需要 `RESOURCE_MANAGE` 权限，系统会自动记录操作日志。

## 注意事项

1. **唯一性约束**: 数据库表设置了 `(user_id, resource_id)` 的唯一约束，防止重复点赞或收藏
2. **事务安全**: 所有操作都包含在事务中，确保数据一致性
3. **错误处理**: 完善的异常处理机制，提供友好的错误提示
4. **操作日志**: 所有写操作都会记录操作日志，便于审计和追踪
5. **分页支持**: 列表查询接口支持分页，提高查询效率

## 测试示例

### 使用curl测试点赞功能

```bash
# 查询点赞状态
curl -X GET "http://localhost:8080/like-favorite/experiment/1?userId=1"

# 点赞
curl -X POST "http://localhost:8080/like-favorite/like/1?userId=1"

# 取消点赞
curl -X POST "http://localhost:8080/like-favorite/unlike/1?userId=1"
```

### 使用curl测试收藏功能

```bash
# 添加收藏
curl -X POST "http://localhost:8080/resource-favorite/add" \
  -H "Content-Type: application/json" \
  -d '{"userId": 1, "resourceId": 1}'

# 查询收藏状态
curl -X GET "http://localhost:8080/resource-favorite/is-favorited?userId=1&resourceId=1"
``` 