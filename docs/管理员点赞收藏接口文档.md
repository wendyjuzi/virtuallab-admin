# 管理员点赞收藏接口文档

## 概述

本文档描述了虚拟实验室系统中管理员专用的点赞收藏管理接口，用于管理系统内所有用户的点赞和收藏数据。

## 基础信息

- **基础路径**: `/admin/like-favorite`
- **认证方式**: JWT Token (需要在请求头中携带 `Authorization: Bearer <token>`)
- **权限要求**: 管理员角色
- **响应格式**: JSON
- **字符编码**: UTF-8

## 通用响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // 具体数据
  }
}
```

## 接口列表

### 1. 获取总体统计数据

**接口地址**: `GET /admin/like-favorite/stats`

**接口描述**: 获取系统点赞收藏的总体统计数据，用于首页统计卡片展示

**请求参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "message": "获取统计数据成功",
  "data": {
    "totalLikes": 1250,
    "totalFavorites": 890,
    "totalUsers": 156,
    "totalResources": 45,
    "avgLikesPerUser": 8.01,
    "avgFavoritesPerUser": 5.71,
    "topUsers": [
      {
        "userId": 1,
        "username": "admin",
        "nickname": "管理员",
        "likeCount": 25,
        "favoriteCount": 18,
        "totalInteractions": 43,
        "lastActivity": "2025-01-15T10:30:00"
      }
    ],
    "topResources": [
      {
        "resourceId": 1,
        "resourceName": "物理力学实验",
        "resourceType": "experiment",
        "likeCount": 45,
        "favoriteCount": 32,
        "totalInteractions": 77,
        "category": "物理实验"
      }
    ]
  }
}
```

### 2. 获取用户统计数据

**接口地址**: `GET /admin/like-favorite/user-stats`

**接口描述**: 获取所有用户的点赞收藏统计数据

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页大小，默认20 |
| search | String | 否 | 搜索用户名 |
| sortBy | String | 否 | 排序字段：likeCount/favoriteCount/totalInteractions |

**响应示例**:
```json
{
  "code": 200,
  "message": "获取用户统计成功",
  "data": {
    "records": [
      {
        "userId": 1,
        "username": "admin",
        "nickname": "管理员",
        "likeCount": 25,
        "favoriteCount": 18,
        "totalInteractions": 43,
        "lastActivity": "2025-01-15T10:30:00",
        "joinTime": "2024-09-01T00:00:00"
      }
    ],
    "total": 156,
    "page": 1,
    "size": 20
  }
}
```

### 3. 获取点赞记录列表

**接口地址**: `GET /admin/like-favorite/likes`

**接口描述**: 获取所有用户的点赞记录，支持分页和搜索

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页大小，默认20 |
| search | String | 否 | 搜索用户ID、资源ID或用户名 |
| startDate | String | 否 | 开始日期 (yyyy-MM-dd) |
| endDate | String | 否 | 结束日期 (yyyy-MM-dd) |

**响应示例**:
```json
{
  "code": 200,
  "message": "获取点赞记录成功",
  "data": {
    "records": [
      {
        "id": 1,
        "userId": 1,
        "username": "admin",
        "nickname": "管理员",
        "resourceId": 1,
        "resourceName": "物理力学实验",
        "resourceType": "experiment",
        "createTime": "2025-01-15T10:30:00",
        "ipAddress": "192.168.1.100",
        "userAgent": "Mozilla/5.0..."
      }
    ],
    "total": 1250,
    "page": 1,
    "size": 20
  }
}
```

### 4. 获取收藏记录列表

**接口地址**: `GET /admin/like-favorite/favorites`

**接口描述**: 获取所有用户的收藏记录，支持分页和搜索

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页大小，默认20 |
| search | String | 否 | 搜索用户ID、资源ID或用户名 |
| startDate | String | 否 | 开始日期 (yyyy-MM-dd) |
| endDate | String | 否 | 结束日期 (yyyy-MM-dd) |

**响应示例**:
```json
{
  "code": 200,
  "message": "获取收藏记录成功",
  "data": {
    "records": [
      {
        "id": 1,
        "userId": 1,
        "username": "admin",
        "nickname": "管理员",
        "resourceId": 1,
        "resourceName": "物理力学实验",
        "resourceType": "experiment",
        "createTime": "2025-01-15T10:30:00",
        "ipAddress": "192.168.1.100",
        "userAgent": "Mozilla/5.0..."
      }
    ],
    "total": 890,
    "page": 1,
    "size": 20
  }
}
```

### 5. 获取资源统计数据

**接口地址**: `GET /admin/like-favorite/resource-stats`

**接口描述**: 获取所有资源的点赞收藏统计数据

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| search | String | 否 | 搜索资源名称 |
| sortBy | String | 否 | 排序字段：likeCount/favoriteCount/totalInteractions |
| category | String | 否 | 按分类筛选 |

**响应示例**:
```json
{
  "code": 200,
  "message": "获取资源统计成功",
  "data": {
    "totalResources": 45,
    "totalLikes": 1250,
    "totalFavorites": 890,
    "avgLikesPerResource": 27.78,
    "avgFavoritesPerResource": 19.78,
    "topResources": [
      {
        "resourceId": 1,
        "resourceName": "物理力学实验",
        "resourceType": "experiment",
        "likeCount": 45,
        "favoriteCount": 32,
        "totalInteractions": 77,
        "category": "物理实验",
        "createTime": "2024-09-01T00:00:00",
        "lastInteraction": "2025-01-15T10:30:00"
      }
    ]
  }
}
```

### 6. 删除单条点赞记录

**接口地址**: `DELETE /admin/like-favorite/like/{id}`

**接口描述**: 删除指定的点赞记录

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 点赞记录ID |

**响应示例**:
```json
{
  "code": 200,
  "message": "删除点赞记录成功",
  "data": 1
}
```

### 7. 删除单条收藏记录

**接口地址**: `DELETE /admin/like-favorite/favorite/{id}`

**接口描述**: 删除指定的收藏记录

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 收藏记录ID |

**响应示例**:
```json
{
  "code": 200,
  "message": "删除收藏记录成功",
  "data": 1
}
```

### 8. 批量删除点赞记录

**接口地址**: `DELETE /admin/like-favorite/likes/batch`

**接口描述**: 批量删除点赞记录

**请求体**:
```json
{
  "ids": [1, 2, 3],
  "reason": "违规内容"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "批量删除点赞记录成功",
  "data": 3
}
```

### 9. 批量删除收藏记录

**接口地址**: `DELETE /admin/like-favorite/favorites/batch`

**接口描述**: 批量删除收藏记录

**请求体**:
```json
{
  "ids": [1, 2, 3],
  "reason": "违规内容"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "批量删除收藏记录成功",
  "data": 3
}
```

### 10. 重置用户统计

**接口地址**: `POST /admin/like-favorite/user/{userId}/reset-stats`

**接口描述**: 重置指定用户的点赞收藏统计数据（删除该用户的所有点赞收藏记录）

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

**响应示例**:
```json
{
  "code": 200,
  "message": "重置用户统计成功",
  "data": {
    "deletedLikes": 25,
    "deletedFavorites": 18
  }
}
```

### 11. 获取用户详细统计

**接口地址**: `GET /admin/like-favorite/user/{userId}/detail`

**接口描述**: 获取指定用户的详细点赞收藏统计信息

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

**响应示例**:
```json
{
  "code": 200,
  "message": "获取用户详细统计成功",
  "data": {
    "userId": 1,
    "username": "admin",
    "nickname": "管理员",
    "likeCount": 25,
    "favoriteCount": 18,
    "totalInteractions": 43,
    "lastActivity": "2025-01-15T10:30:00",
    "joinTime": "2024-09-01T00:00:00",
    "recentLikes": [
      {
        "id": 1,
        "resourceId": 1,
        "resourceName": "物理力学实验",
        "createTime": "2025-01-15T10:30:00"
      }
    ],
    "recentFavorites": [
      {
        "id": 1,
        "resourceId": 1,
        "resourceName": "物理力学实验",
        "createTime": "2025-01-15T10:30:00"
      }
    ]
  }
}
```

### 12. 获取资源详细统计

**接口地址**: `GET /admin/like-favorite/resource/{resourceId}/detail`

**接口描述**: 获取指定资源的详细点赞收藏统计信息

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| resourceId | Long | 是 | 资源ID |

**响应示例**:
```json
{
  "code": 200,
  "message": "获取资源详细统计成功",
  "data": {
    "resourceId": 1,
    "resourceName": "物理力学实验",
    "resourceType": "experiment",
    "category": "物理实验",
    "likeCount": 45,
    "favoriteCount": 32,
    "totalInteractions": 77,
    "createTime": "2024-09-01T00:00:00",
    "lastInteraction": "2025-01-15T10:30:00",
    "recentLikes": [
      {
        "id": 1,
        "userId": 1,
        "username": "admin",
        "createTime": "2025-01-15T10:30:00"
      }
    ],
    "recentFavorites": [
      {
        "id": 1,
        "userId": 1,
        "username": "admin",
        "createTime": "2025-01-15T10:30:00"
      }
    ]
  }
}
```

### 13. 导出数据

**接口地址**: `GET /admin/like-favorite/export`

**接口描述**: 导出点赞收藏数据

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| format | String | 否 | 导出格式：excel/csv，默认excel |
| type | String | 否 | 数据类型：likes/favorites/users/resources/all，默认all |
| startDate | String | 否 | 开始日期 (yyyy-MM-dd) |
| endDate | String | 否 | 结束日期 (yyyy-MM-dd) |

**响应**: 文件流，Content-Type根据format参数确定

### 14. 获取系统概览

**接口地址**: `GET /admin/like-favorite/overview`

**接口描述**: 获取系统整体概览数据

**响应示例**:
```json
{
  "code": 200,
  "message": "获取系统概览成功",
  "data": {
    "totalUsers": 156,
    "totalResources": 45,
    "totalLikes": 1250,
    "totalFavorites": 890,
    "todayLikes": 15,
    "todayFavorites": 8,
    "weekLikes": 89,
    "weekFavorites": 56,
    "monthLikes": 234,
    "monthFavorites": 167,
    "topCategories": [
      {
        "category": "物理实验",
        "likeCount": 450,
        "favoriteCount": 320
      }
    ],
    "activityTrend": [
      {
        "date": "2025-01-15",
        "likes": 15,
        "favorites": 8
      }
    ]
  }
}
```

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 401 | 未授权，需要登录 |
| 403 | 权限不足，需要管理员权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 注意事项

1. **权限控制**: 所有接口都需要管理员权限，请在请求头中携带有效的JWT Token
2. **分页参数**: page从1开始，size建议不超过100
3. **时间格式**: 所有时间字段使用ISO 8601格式 (yyyy-MM-ddTHH:mm:ss)
4. **数据关联**: 资源ID关联的是实验项目表(experiment_project)的ID
5. **性能优化**: 大数据量查询建议使用分页，避免一次性返回过多数据
6. **数据一致性**: 删除操作会同时更新相关统计数据

## 数据库表结构

### resource_like (点赞记录表)
```sql
CREATE TABLE resource_like (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    resource_id BIGINT NOT NULL,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_resource (user_id, resource_id)
);
```

### resource_favorite (收藏记录表)
```sql
CREATE TABLE resource_favorite (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    resource_id BIGINT NOT NULL,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_resource (user_id, resource_id)
);
```

### 关联表
- `user_id` 关联 `user` 表的 `id`
- `resource_id` 关联 `experiment_project` 表的 `id`

## 更新日志

- **v1.0.0** (2025-01-15): 初始版本，包含基础的CRUD操作
- **v1.1.0** (2025-01-16): 新增批量操作和导出功能
- **v1.2.0** (2025-01-17): 新增详细统计和系统概览功能 